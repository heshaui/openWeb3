
# Web3 å­¦ä¹ é—®ç­”æ±‡æ€»ï¼ˆåŸºäº ethers.jsï¼‰

> æœ¬æ–‡æ•´ç†è‡ªä¸€ç³»åˆ— Web3 åˆå­¦é—®é¢˜ï¼Œä¸»è¦åŸºäº `ethers.js` åº“ï¼Œæ¶µç›–é’±åŒ…è¿æ¥ã€provider ä½¿ç”¨ã€åˆçº¦äº¤äº’ã€å¸¸è§åˆçº¦ç­‰å†…å®¹ã€‚

---

## ğŸŒŸ Q1ï¼š`ethers.js` ä¸­ `HDNodeWallet` å’Œ `Wallet` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

- `Wallet`: åŸºäºç§é’¥åˆ›å»ºçš„é’±åŒ…ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚
- `HDNodeWallet`: åŸºäºåŠ©è®°è¯ï¼ˆMnemonicï¼‰æˆ– HD è·¯å¾„ï¼ˆå¦‚ `m/44'/60'/0'/0/0`ï¼‰åˆ›å»ºçš„é’±åŒ…ï¼Œæ”¯æŒå¤šè´¦æˆ·æ´¾ç”Ÿã€‚

```ts
import { HDNodeWallet, Wallet } from 'ethers';

const wallet = new Wallet(privateKey); // å¸¸è§ç”¨æ³•
const hdWallet = HDNodeWallet.fromPhrase(mnemonic); // ä»åŠ©è®°è¯æ¢å¤
```

---

## ğŸŒŸ Q2ï¼šETH å’Œ WETH æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

- **ETH** æ˜¯ä»¥å¤ªåŠçš„åŸç”Ÿè´§å¸ï¼Œä¸æ˜¯åˆçº¦å®ç°çš„ã€‚
- **WETH** æ˜¯ Wrapped ETHï¼Œå…¼å®¹ ERC20 çš„åŒ…è£…ç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªåˆçº¦ä»£å¸ã€‚

| ç±»å‹ | æ˜¯å¦ ERC20 | ç”¨é€” |
|------|-------------|------|
| ETH  | âŒ           | åŸç”Ÿä»£å¸ï¼Œæ”¯ä»˜ gas |
| WETH | âœ…           | å¯ç”¨äº DeFiã€åˆçº¦äº¤äº’ |

---

## ğŸŒŸ Q3ï¼šæŸ¥è¯¢ ETH å’Œ WETH çš„ä½™é¢ç”¨çš„æ–¹æ³•ä¸€æ ·å—ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

ä¸ä¸€æ ·ï¼

- æŸ¥è¯¢ **ETH** ä½™é¢ï¼šç”¨ `provider.getBalance(address)`
- æŸ¥è¯¢ **WETH** ä½™é¢ï¼šç”¨ `contract.balanceOf(address)`

```ts
const ethBalance = await provider.getBalance(address); // æŸ¥è¯¢ ETH
const wethBalance = await contract.balanceOf(address); // æŸ¥è¯¢ WETH
```

---

## ğŸŒŸ Q4ï¼šä¸ºä»€ä¹ˆè°ƒç”¨ `multiTransferETH()` æ—¶ä¼ å…¥çš„ value å¿…é¡»æ˜¯ 0.002ï¼Œè€Œä¸èƒ½æ˜¯ 0.001ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

ä½ è°ƒç”¨çš„æ˜¯ç±»ä¼¼è¿™æ ·çš„åˆçº¦å‡½æ•°ï¼š

```solidity
function multiTransferETH(address[] memory, uint256[] memory) public payable
```

åˆçº¦å†…éƒ¨å¯èƒ½æœ‰å¦‚ä¸‹é€»è¾‘ï¼š

```solidity
require(msg.value >= totalAmount, "Insufficient ETH");
```

å¦‚æœä½ ä¼ å…¥çš„ `msg.value`ï¼ˆvalueï¼‰æ¯”åˆçº¦è¦è½¬å‡ºçš„æ€»é‡‘é¢ï¼ˆæˆ–æ‰‹ç»­è´¹ï¼‰ä½ï¼Œå°±ä¼š `revert`ã€‚æ‰€ä»¥ä½ ä¼  `0.001` ä¼šå¤±è´¥ï¼Œ`0.002` è¶³å¤Ÿæ‰æˆåŠŸã€‚

---

## ğŸŒŸ Q5ï¼šweb3 é¡¹ç›®çš„ä¸šåŠ¡å¤§ä½“é€»è¾‘æ˜¯æ€æ ·çš„ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

1. **é’±åŒ…è¿æ¥**
   - ç”¨æˆ·è¿æ¥é’±åŒ…ï¼ˆMetaMaskã€WalletConnectï¼‰
   - è·å–åœ°å€ã€å…¬é’¥

2. **é“¾ä¸Šæ•°æ®è¯»å–**
   - æŸ¥è¯¢ ETH/ERC20 ä½™é¢ã€NFTã€é“¾ä¸ŠçŠ¶æ€

3. **åˆçº¦äº¤äº’**
   - å‘èµ·äº¤æ˜“ï¼ˆè½¬è´¦ã€mintã€stakeã€swap ç­‰ï¼‰
   - ç­¾åæ¶ˆæ¯æˆ–äº¤æ˜“

4. **å‰ç«¯ UI ä¸çŠ¶æ€ç®¡ç†**
   - æ˜¾ç¤ºé“¾ä¸Šæ•°æ®ã€å¤„ç†çŠ¶æ€
   - ç›‘å¬äº¤æ˜“ç¡®è®¤ï¼ˆtx.wait()ï¼‰

5. **å®‰å…¨ä¸æˆæƒ**
   - ç­¾åéªŒè¯ï¼ˆEIP-712ï¼‰ã€MetaTxã€æƒé™æ ¡éªŒ

---

## ğŸŒŸ Q6ï¼šERC20 çš„ ABI å’Œåˆçº¦åœ°å€å¯ä»¥ç›´æ¥ç²˜è´´ä½¿ç”¨å—ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

å¯ä»¥ï¼å¸¸ç”¨æ ‡å‡†åˆçº¦å¦‚ ERC20ã€Uniswap ç­‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ ABI å’Œåœ°å€ã€‚

```ts
const contract = new ethers.Contract(tokenAddress, erc20Abi, providerOrSigner);
```

---

## ğŸŒŸ Q7ï¼šæˆ‘é€šè¿‡ `wallet = new Wallet(privateKey, provider)` è¿æ¥é’±åŒ…ï¼Œå†ç”¨åˆçº¦ ABI + åœ°å€æ„å»ºåˆçº¦å¯¹è±¡ï¼Œé‚£ `provider.getBalance(wallet.getAddress())` æŸ¥çš„æ˜¯è°çš„ä½™é¢ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

ä½ æŸ¥çš„æ˜¯è¿™ä¸ªç§é’¥é’±åŒ…çš„ ETH ä½™é¢ã€‚

```ts
const balance = await provider.getBalance(await wallet.getAddress());
```

---

## ğŸŒŸ Q8ï¼šæœ‰å“ªäº›å¸¸ç”¨å…¬å…±åˆçº¦å¯ä»¥ç›´æ¥ä½¿ç”¨ ABI + åœ°å€æ“ä½œï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

| åˆçº¦ | ç½‘ç»œ | åœ°å€/ABI è·å– |
|------|------|----------------|
| WETH | æ‰€æœ‰ä¸»æµé“¾ | WETH9 åˆçº¦ |
| USDT/USDC | ä¸»ç½‘ | TokenListã€CoinGecko |
| Uniswap Router | ä¸»ç½‘ | Uniswap å®˜æ–¹æ–‡æ¡£ |
| Chainlink Oracle | ä¸»ç½‘ | Chainlink å®˜ç½‘ |
| ENS Registry | Ethereum | ENS å®˜æ–¹æ–‡æ¡£ |
| Airdrop åˆçº¦ | éæ ‡å‡†ï¼Œä¸€èˆ¬ä¸ºé¡¹ç›®æ–¹è‡ªå®šä¹‰ |

---

## ğŸŒŸ Q9ï¼š`provider` çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

`provider` æ˜¯è¿æ¥åŒºå—é“¾çš„é€šé“ï¼Œå®ƒï¼š

- ç”¨äºæŸ¥è¯¢åŒºå—é“¾æ•°æ®ï¼ˆå¦‚ä½™é¢ã€åŒºå—ã€äº¤æ˜“çŠ¶æ€ï¼‰
- è´Ÿè´£å¹¿æ’­å·²ç­¾åçš„äº¤æ˜“
- æ˜¯ `ethers.js` ä¸ä»¥å¤ªåŠèŠ‚ç‚¹ä¹‹é—´çš„æ¡¥æ¢

å¸¸ç”¨æ„é€ æ–¹å¼ï¼š

```ts
const provider = new ethers.JsonRpcProvider(RPC_URL);
```

---

## ğŸŒŸ Q10ï¼š`new Contract(address, abi, wallet)` è¿™ç§ç”¨æ³•ä¹Ÿç®—ç­¾åäº†äº¤æ˜“å—ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

âœ… æ˜¯çš„ï¼

å½“ä½ ç»™åˆçº¦ä¼ å…¥çš„æ˜¯ `wallet`ï¼ˆSignerï¼‰ï¼Œè°ƒç”¨åˆçº¦å†™æ“ä½œæ—¶ï¼Œ`ethers.js` ä¼šè‡ªåŠ¨å®Œæˆï¼š

- ç¼–ç å‚æ•°
- ç”¨ç§é’¥ç­¾åäº¤æ˜“
- å‘é€äº¤æ˜“åˆ°é“¾ä¸Š

```ts
const contract = new ethers.Contract(address, abi, wallet);
await contract.transfer(to, amount); // è‡ªåŠ¨ç­¾å + å¹¿æ’­
```

---

## ğŸŒŸ Q11ï¼š`provider.call()` æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ

### âœ… ç­”æ¡ˆï¼š

`provider.call(tx)` æ˜¯ä¸€ç§**æœ¬åœ°æ¨¡æ‹Ÿæ‰§è¡Œ**åˆçº¦æ–¹æ³•çš„æ–¹å¼ï¼š

- ä¸ä¼šæ¶ˆè€— gas
- ä¸ä¼šä¸Šé“¾
- å¸¸ç”¨äº `view` æˆ– `pure` å‡½æ•°
- ä¹Ÿå¯ç”¨äºæµ‹è¯•æŸäº¤æ˜“æ˜¯å¦ä¼šæˆåŠŸï¼ˆæ¨¡æ‹Ÿï¼‰

```ts
const result = await provider.call({
  to: contractAddress,
  data: encodedFunctionData
});
```

ä½ å¯ä»¥ç”¨ ABI æ¥ encode/decodeï¼š

```ts
const iface = new ethers.Interface(abi);
const data = iface.encodeFunctionData("balanceOf", [address]);
const raw = await provider.call({ to, data });
const decoded = iface.decodeFunctionResult("balanceOf", raw);
```

---

## ğŸ”š æ€»ç»“

æŒæ¡è¿™äº›åŸºç¡€ï¼Œä½ åŸºæœ¬å¯ä»¥å®ç°å¤§éƒ¨åˆ† Web3 DApp çš„å¸¸è§„åŠŸèƒ½ï¼šé’±åŒ…è¿æ¥ã€èµ„äº§æŸ¥è¯¢ã€åˆçº¦è°ƒç”¨ã€äº¤æ˜“ç­¾åã€é“¾ä¸Šæ•°æ®è¯»å–ç­‰ã€‚åç»­å¯ä»¥é€æ­¥æ·±å…¥ MetaTxã€EIP-712 ç­¾åã€Layer2ã€DeFi ç­‰æ–¹å‘ã€‚
